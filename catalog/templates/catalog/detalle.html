{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="container py-5">
    <div class="row">
        <!-- Columna de imagen -->
        <div class="col-md-5">
            <div class="detalle-imagen-container">
                <img src="{% static juego.imagen %}" 
                     alt="{{ juego.nombre }}" 
                     class="img-fluid detalle-imagen"
                     onerror="this.onerror=null; this.src='/static/img/default.png'">
            </div>
        </div>
        
        <!-- Columna de informaci√≥n -->
        <div class="col-md-7">
            <h1 class="detalle-titulo">{{ juego.nombre }}</h1>
            
            <div class="detalle-consola-badge">
                {{ juego.get_consola_display }}
            </div>
            
            {% if juego.genero %}
            <p class="genero">
                <strong>G√©nero:</strong> {{ juego.genero }}
            </p>
            {% endif %}
            
            <div class="detalle-descripcion">
                <h5>Descripci√≥n</h5>
                {% if juego.descripcion %}
                    <p>{{ juego.descripcion }}</p>
                {% endif %}
                <p>Este juego est√° disponible en:</p>
                <p><strong>M√©todo PRIMARIO:</strong> Jugas en tu usuario personal, una vez instalado no necesita WiFi</p>
                <p><strong>M√©todo SECUNDARIO:</strong> Jugas desde el usuario entregado, siempre conectado a WiFi</p>
                <p>Cont√°s con 1 a√±o de garant√≠a con todos los juegos</p>
                <p>Descuento exclusivo √∫nicamente en transferencia!</p>
            </div>
            
            <!-- ‚≠ê SECCI√ìN DE PRECIOS ACTUALIZADA -->
            <div class="detalle-precios-section">
                <h5 class="mb-3">üí∞ Elige tu opci√≥n de compra</h5>
                
                <div class="precios-opciones">
                    <!-- OPCI√ìN PRIMARIO -->
                    <div class="precio-card primario {% if not juego.tiene_secundario %}unico{% endif %}">
                        <div class="precio-header">
                            <span class="precio-badge primario-badge">üü¢ PRIMARIO</span>
                            {% if juego.tiene_secundario and juego.precio <= juego.precio_secundario %}
                                <span class="mejor-precio-tag">‚≠ê MEJOR PRECIO</span>
                            {% endif %}
                        </div>
                        
                        <div class="precio-contenido">
                            <div class="precio-info">
                                <div class="precio-base-detalle">
                                    Precio base: <span class="text-muted">${{ juego.recargo|floatformat:0 }}</span>
                                </div>
                                <div class="precio-final-detalle">
                                    <span class="precio-label">Precio final: (Transferencia)</span>
                                    <span class="precio-valor">${{ juego.precio|floatformat:0 }}</span>
                                </div>
                            </div>
                            
                            <div class="precio-ventajas">
                                <ul>
                                    <li>‚úÖ Jugas en tu usuario personal</li>
                                    <li>‚úÖ No necesita WiFi despu√©s de instalar</li>
                                    <li>‚úÖ M√°xima comodidad</li>
                                </ul>
                            </div>
                            
                            <button class="btn-comprar-detalle btn-primario"
                                    hx-post="{% url 'carrito:agregar' juego.id %}?tipo=primario"
                                    hx-target="body"
                                    hx-swap="none">
                                <i class="fas fa-cart-plus"></i> Agregar Primario
                            </button>
                        </div>
                    </div>
                    
                    <!-- OPCI√ìN SECUNDARIO (si existe) -->
                    {% if juego.tiene_secundario or juego.es_solo_secundario %}
                    <div class="precio-card secundario">
                        <div class="precio-header">
                            <span class="precio-badge secundario-badge">üîµ SECUNDARIO</span>
                            {% if juego.tiene_secundario and juego.precio_secundario < juego.precio %}
                                <span class="mejor-precio-tag">‚≠ê MEJOR PRECIO</span>
                            {% endif %}
                        </div>
                        
                        <div class="precio-contenido">
                            <div class="precio-info">
                                <div class="precio-base-detalle">
                                    Precio base: <span class="text-muted">
                                        ${{ juego.recargo_secundario|default:juego.recargo|floatformat:0 }}
                                    </span>
                                </div>
                                <div class="precio-final-detalle">
                                    <span class="precio-label">Precio final: (Transferencia)</span>
                                    <span class="precio-valor">
                                       ${{ juego.precio_secundario|default:juego.precio|floatformat:0 }}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="precio-ventajas">
                                <ul>
                                    <li>‚úÖ Precio m√°s econ√≥mico</li>
                                    <li>‚ö†Ô∏è Requiere WiFi permanente</li>
                                    <li>‚ö†Ô∏è Jugas desde el usuario entregado</li>
                                </ul>
                            </div>
                            
                            <button class="btn-comprar-detalle btn-secundario"
                                    hx-post="{% url 'carrito:agregar' juego.id %}?tipo=secundario"
                                    hx-target="body"
                                    hx-swap="none">
                                <i class="fas fa-cart-plus"></i> Agregar Secundario
                            </button>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Ahorro destacado -->
                {% if juego.tiene_secundario %}
                <div class="ahorro-info">
                    {% if juego.precio_secundario < juego.precio %}
                        üí° <strong>Ahorr√°s ${{ juego.recargo|floatformat:0|add:"-"|add:juego.recargo_secundario|floatformat:0 }}</strong> 
                        eligiendo Secundario
                    {% elif juego.precio < juego.precio_secundario %}
                        üí° <strong>Ahorr√°s ${{ juego.recargo_secundario|floatformat:0|add:"-"|add:juego.recargo|floatformat:0 }}</strong> 
                        eligiendo Primario
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <!-- M√©todos de pago -->
            <div class="detalle-metodos-pago">
                <h5>M√©todos de pago aceptados</h5>
                <div class="metodos-iconos">
                    <span class="metodo-pago">üíµ Efectivo</span>
                    <span class="metodo-pago">üè¶ Transferencia</span>
                    <span class="metodo-pago">üí≥ Tarjeta de Cr√©dito/D√©bito</span>
                </div>
            </div>
            
            <!-- Botones de acci√≥n -->
            <div class="detalle-acciones">
                <a href="https://wa.me/5491151594477?text=Hola!%20Me%20interesa%20el%20{{ juego.nombre|urlencode }}" 
                   class="btn-whatsapp" target="_blank">
                    <i class="fa-brands fa-whatsapp"></i>
                    Consultar por WhatsApp
                </a>
                <a href="javascript:history.back()" class="btn-catalogo">
                    <i class="fas fa-arrow-left"></i>
                    Volver al cat√°logo
                </a>
            </div>
        </div>
    </div>
</div>

<style>
/* ===== ESTILOS PARA PRECIOS DUALES EN DETALLE ===== */

.detalle-precios-section {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 12px;
    margin: 25px 0;
}

.detalle-precios-section h5 {
    color: #2c3e50;
    font-weight: bold;
    margin-bottom: 20px;
}

.precios-opciones {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 15px;
}

/* Cards de precio */
.precio-card {
    background: white;
    border: 3px solid #ddd;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
    position: relative;
}

.precio-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.precio-card.primario {
    border-color: #4CAF50;
}

.precio-card.secundario {
    border-color: #2196F3;
}

.precio-card.unico {
    grid-column: 1 / -1;
    max-width: 500px;
    margin: 0 auto;
    width: 100%;
}

/* Header del precio */
.precio-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.precio-badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.85rem;
}

.primario-badge {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
}

.secundario-badge {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    color: white;
}

.mejor-precio-tag {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: bold;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Contenido del precio */
.precio-contenido {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.precio-info {
    text-align: center;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.precio-base-detalle {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 8px;
}

.precio-base-detalle .text-muted {
    text-decoration: line-through;
}

.precio-final-detalle {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}

.precio-label {
    font-size: 0.85rem;
    color: #666;
    font-weight: 500;
}

.precio-valor {
    font-size: 2rem;
    font-weight: bold;
    color: #2c3e50;
}

/* Ventajas */
.precio-ventajas {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
}

.precio-ventajas ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.precio-ventajas li {
    padding: 5px 0;
    font-size: 0.9rem;
    color: #555;
}

/* Botones de compra */
.btn-comprar-detalle {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primario {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
}

.btn-primario:hover {
    background: linear-gradient(135deg, #45a049, #3d8b40);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
}

.btn-secundario {
    background: linear-gradient(135deg, #2196F3, #1976D2);
    color: white;
}

.btn-secundario:hover {
    background: linear-gradient(135deg, #1976D2, #1565C0);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
}

/* Info de ahorro */
.ahorro-info {
    text-align: center;
    padding: 12px;
    background: linear-gradient(135deg, #FFF9C4, #FFF59D);
    border-radius: 8px;
    border: 2px solid #FDD835;
    font-size: 1rem;
}

/* Responsive */
@media (max-width: 768px) {
    .precios-opciones {
        grid-template-columns: 1fr;
    }
    
    .precio-card.unico {
        max-width: 100%;
    }
    
    .precio-valor {
        font-size: 1.6rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Formatear todos los precios
    document.querySelectorAll('.precio-valor, .precio-base-detalle .text-muted, .ahorro-info strong').forEach(function(el) {
        let text = el.textContent.trim();
        if (text.includes('$')) {
            let precio = text.replace(/[^\d]/g, '');
            if (precio) {
                el.textContent = '$' + parseInt(precio).toLocaleString('es-AR');
            }
        }
    });
});

// Feedback al agregar al carrito
document.body.addEventListener('htmx:afterRequest', function(event) {
    if (event.detail.xhr.status === 200) {
        const button = event.detail.elt;
        const originalHTML = button.innerHTML;
        const originalBg = button.style.background;
        
        button.innerHTML = '<i class="fas fa-check"></i> ¬°Agregado al carrito!';
        button.style.background = '#4CAF50';
        button.disabled = true;
        
        setTimeout(function() {
            button.innerHTML = originalHTML;
            button.style.background = originalBg;
            button.disabled = false;
        }, 2000);
    }
});
</script>

{% endblock %}